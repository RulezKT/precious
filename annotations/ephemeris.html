<!DOCTYPE html>  <html> <head>   <title>ephemeris.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="post-install.html">                 post-install.coffee               </a>                                           <a class="source" href="precious.html">                 precious.coffee               </a>                                           <a class="source" href="convenient.html">                 convenient.coffee               </a>                                           <a class="source" href="ephemeris.html">                 ephemeris.coffee               </a>                                           <a class="source" href="errs.html">                 errs.coffee               </a>                                           <a class="source" href="man.html">                 man.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               ephemeris.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_      = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">)</span>
<span class="nv">nice   = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./convenient&#39;</span><span class="p">)</span>
<span class="nv">Stream = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;stream&#39;</span><span class="p">).</span><span class="nx">Stream</span>
<span class="nv">spawn  = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;child_process&#39;</span><span class="p">).</span><span class="nx">spawn</span>
<span class="nv">json   = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jsonify&#39;</span><span class="p">)</span>
<span class="nv">errs   = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./errs&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>A node implementation may be added straight here in this module.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">module.exports = </span><span class="nf">(input = {}, opts = {}) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>When convenient is true, the input is made nice - if it isn't already
just fine.  If the caller would rather put less effort, the convenient
is nice to help.  This is not about validation, but less input requirements.
Empty input defaults to convenient as well.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="o">or</span> <span class="nx">opts</span><span class="o">?</span><span class="p">.</span><span class="nx">convenient</span> <span class="o">is</span> <span class="kc">true</span>
    <span class="nv">input = </span><span class="nx">nice</span> <span class="nx">input</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>The implementation method isn't checked yet.
Python is the only one, so far.
opts.method ?= "py"</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">stream = </span><span class="k">new</span> <span class="nx">Stream</span>
  <span class="nv">stream.writable = </span><span class="kc">true</span>

  <span class="nv">source = </span><span class="nx">spawn</span> <span class="s2">&quot;python&quot;</span>
    <span class="p">,</span> <span class="p">[</span><span class="s2">&quot;../bin/ephemeris.py&quot;</span><span class="p">,</span> <span class="s2">&quot;#{json.stringify input}&quot;</span><span class="p">]</span>
    <span class="p">,</span> <span class="p">{</span> <span class="nv">cwd: </span><span class="nx">__dirname</span> <span class="p">}</span>

  <span class="nx">source</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="kc">on</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nf">(stdout) -&gt;</span>
    <span class="nx">stream</span><span class="p">.</span><span class="nx">emit</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">stdout</span>

  <span class="nx">source</span><span class="p">.</span><span class="nx">stderr</span><span class="p">.</span><span class="kc">on</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nf">(stderr) -&gt;</span>
    <span class="nx">stream</span><span class="p">.</span><span class="nx">emit</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">errs</span><span class="p">.</span><span class="nx">create</span> <span class="s1">&#39;ephemeris&#39;</span><span class="p">,</span> <span class="nv">message: </span><span class="nx">stderr</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>

  <span class="nx">source</span><span class="p">.</span><span class="kc">on</span> <span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="nf">(code) -&gt;</span>
    <span class="k">if</span> <span class="nx">code</span> <span class="o">isnt</span> <span class="mi">0</span>
      <span class="nx">stream</span><span class="p">.</span><span class="nx">emit</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">errs</span><span class="p">.</span><span class="nx">create</span> <span class="s1">&#39;ephemeris&#39;</span><span class="p">,</span>
        <span class="nv">message: </span><span class="s2">&quot;Spawned child_process exited with code #{code}!&quot;</span>
    <span class="nx">stream</span><span class="p">.</span><span class="nx">emit</span> <span class="s1">&#39;end&#39;</span>

  <span class="nx">stream</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 